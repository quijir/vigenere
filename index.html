<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>vigenere cipher</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://pyscript.net/releases/2024.9.1/core.js"></script>
  </head>
  <body>
    <h1>vigenere cipher</h1>
    <div>
      <h2>encode</h2>
      <form id="formencode">
        <label>input:</label>
        <textarea rows="5" cols="90" name="input"></textarea>
        <label>key:</label>
        <textarea rows="3" cols="35" name="key"></textarea>
        <label>charset:</label>
        <textarea rows="3" cols="35" name="charset">abcdefghijklmnopqrstuvwxyz</textarea>
      </form>
      <h3>output:</h3>
      <p id="encode">no input</p>
      <button id="copy-encode">copy</button>
    </div>
    <div>
      <h2>decode</h2>
      <form id="formdecode">
        <label>input:</label>
        <textarea rows="5" cols="90" name="input"></textarea>
        <label>key:</label>
        <textarea rows="3" cols="35" name="key"></textarea>
        <label>charset:</label>
        <textarea rows="3" cols="35" name="charset">abcdefghijklmnopqrstuvwxyz</textarea>
      </form>
      <h3>output:</h3>
      <p id="decode">no input</p>
      <button id="copy-decode">copy</button>
    </div>
    <script type="py">
from js import document, window, navigator
from pyodide.ffi import create_proxy
import math

def decode(text,key,chars):
  if chars == chars.lower():
    text = text.lower()
  elif chars == chars.upper():
    text = text.upper()
  decoded = ""
  key = key.lower()
  old_key = key
  j = 0
  for i in range(math.ceil(len(text)/len(key))):
    key += old_key
  for i in range(len(text)):
    if text[i] in chars:
      decoded += chars[(chars.index(text[i])+chars.index(key[j]))%len(chars)]
      j+=1
    else:
      decoded += text[i]
  return decoded
def encode(text,key,chars):
  if chars == chars.lower():
    text = text.lower()
  elif chars == chars.upper():
    text = text.upper()
  encoded = ""
  key = key.lower()
  old_key = key
  j = 0
  for i in range(math.ceil(len(text)/len(key))):
    key += old_key
  for i in range(len(text)):
    if text[i] in chars:
      encoded += chars[(chars.index(text[i])-chars.index(key[j]))%len(chars)]
      j+=1
    else:
      encoded += text[i]
  return encoded
      
def copy_encode(event):
    text = document.getElementById("encode").innerText
    navigator.clipboard.writeText(text)
def copy_decode(event):
    text = document.getElementById("decode").innerText
    navigator.clipboard.writeText(text)
document.getElementById("copy-encode").onclick = copy_encode
document.getElementById("copy-decode").onclick = copy_decode

def collect_encode(event=None):
    form = document.getElementById("formencode")
    if not form:
        return
    data = {el.name: el.value for el in form.elements if el.name}
    out = encode(
        data.get("input", ""),
        data.get("key", ""),
        data.get("charset", "abcdefghijklmnopqrstuvwxyz")
    )
    document.querySelector("#encode").innerHTML = out if out else "no input"
def collect_decode(event=None):
    form = document.getElementById("formdecode")
    if not form:
        return
    data = {el.name: el.value for el in form.elements if el.name}
    out = decode(
        data.get("input", ""),
        data.get("key", ""),
        data.get("charset", "abcdefghijklmnopqrstuvwxyz")
    )
    document.querySelector("#decode").innerHTML = out if out else "no input"

def attach_listeners():
    encode_form = document.getElementById("formencode")
    decode_form = document.getElementById("formdecode")

    if encode_form is None or decode_form is None:
        window.setTimeout(attach_listeners, 100)
        return

    global encode_proxy, decode_proxy
    encode_proxy = create_proxy(collect_encode)
    decode_proxy = create_proxy(collect_decode)
    encode_form.addEventListener("input", encode_proxy)
    decode_form.addEventListener("input", decode_proxy)
    collect_encode()
    collect_decode()

attach_listeners()
    </script>
  </body>
</html>





