<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Vigenere Cipher</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://pyscript.net/releases/2024.9.1/core.js"></script>
  </head>

  <body>
    <h1>Vigenere Cipher</h1>
<div>
  <h2>Encode</h2>
  <form id="formencode">
    <label>Input:</label>
    <textarea rows="5" cols="90" name="input"></textarea>
    <label>Key:</label>
    <textarea rows="3" cols="35" name="key"></textarea>
    <label>Charset:</label>
    <textarea rows="3" cols="35" name="charset">abcdefghijklmnopqrstuvwxyz</textarea>
  </form>
  <h3>Output:</h3>
  <p id="encode">no input</p>
  <button id="copy-encode">copy</button>
</div>

<div>
  <h2>Decode</h2>
  <form id="formdecode">
    <label>Input:</label>
    <textarea rows="5" cols="90" name="input"></textarea>
    <label>Key:</label>
    <textarea rows="3" cols="35" name="key"></textarea>
    <label>Charset:</label>
    <textarea rows="3" cols="35" name="charset">abcdefghijklmnopqrstuvwxyz</textarea>
  </form>
  <h3>Output:</h3>
  <p id="decode">no input</p>
  <button id="copy-decode">copy</button>
</div>

    <script type="py">
from js import document, window, navigator
from pyodide.ffi import create_proxy
import math


def encode(text, key, chars):
    if not key:
        return text
    key = key.lower()
    key = (key * math.ceil(len(text) / len(key)))[:len(text)]
    result = ""
    for i, ch in enumerate(text):
        if ch in chars:
            result += chars[((chars.index(ch) + chars.index(key[i])) % len(chars))+1]
        else:
            result += ch
    return result


def decode(text, key, chars):
    if not key:
        return text
    key = key.lower()
    key = (key * math.ceil(len(text) / len(key)))[:len(text)]
    result = ""
    for i, ch in enumerate(text):
        if ch in chars:
            result += chars[((chars.index(ch) - chars.index(key[i])) % len(chars))-1]
        else:
            result += ch
    return result

def copy_encode(event):
    text = document.getElementById("encode").innerText
    navigator.clipboard.writeText(text)
def copy_decode(event):
    text = document.getElementById("decode").innerText
    navigator.clipboard.writeText(text)
document.getElementById("copy-encode").onclick = copy_encode
document.getElementById("copy-decode").onclick = copy_decode

def collect_encode(event=None):
    form = document.getElementById("formencode")
    if not form:
        return
    data = {el.name: el.value for el in form.elements if el.name}
    out = encode(
        data.get("input", ""),
        data.get("key", ""),
        data.get("charset", "abcdefghijklmnopqrstuvwxyz")
    )
    document.querySelector("#encode").innerHTML = out if out else "no input"


def collect_decode(event=None):
    form = document.getElementById("formdecode")
    if not form:
        return
    data = {el.name: el.value for el in form.elements if el.name}
    out = decode(
        data.get("input", ""),
        data.get("key", ""),
        data.get("charset", "abcdefghijklmnopqrstuvwxyz")
    )
    document.querySelector("#decode").innerHTML = out if out else "no input"


def attach_listeners():
    encode_form = document.getElementById("formencode")
    decode_form = document.getElementById("formdecode")

    if encode_form is None or decode_form is None:
        window.setTimeout(attach_listeners, 100)
        return

    global encode_proxy, decode_proxy
    encode_proxy = create_proxy(collect_encode)
    decode_proxy = create_proxy(collect_decode)

    encode_form.addEventListener("input", encode_proxy)
    decode_form.addEventListener("input", decode_proxy)

    collect_encode()
    collect_decode()


attach_listeners()
    </script>
  </body>
</html>
